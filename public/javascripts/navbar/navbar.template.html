<!-- Angular UI templates -->
<script type="text/ng-template" id="userDisplay.html">
    <div ng-init="friendCtrl = $parent.$parent.$parent.friendCtrl; r = friendCtrl.friendRequestHandler.checkStatus(match.label)">
        <span ng-bind-html="match.label | uibTypeaheadHighlight:query"></span>
        <img class="user-img" src="https://s3.postimg.org/yf86x7z1r/img2.jpg" alt="">
        <span ng-if="r.status == friendCtrl.STATUS_CODES.PENDING">
            <button ng-if="r.actionUser == friendCtrl.username" ng-click="friendCtrl.friendRequestHandler.removeFriend(match.label)" class="btn btn-primary">Cancel</button>
            <button ng-if="r.actionUser == match.label" ng-click="friendCtrl.friendRequestHandler.acceptFriend(match.label)" class="btn btn-primary">Accept</button>
        </span>
        <span ng-if="r.status == friendCtrl.STATUS_CODES.ACCEPTED">
            <button class="btn btn-primary" ng-click="friendCtrl.friendRequestHandler.removeFriend(match.label)">Unfriend</button>
        </span>
        <span ng-if="!friendCtrl.angular.equals(r, {}) && r.status != friendCtrl.STATUS_CODES.PENDING && r.status != friendCtrl.STATUS_CODES.ACCEPTED">
            <button class="btn btn-primary" ng-click="friendCtrl.friendRequestHandler.addFriend(match.label)">Add</button>
        </span>
    </div>
</script>

<div class="container-fluid">
    <div class="navbar-header">
        <a class="navbar-brand">Hello {{ friendCtrl.username }}</a>
    </div>
    <ul class="nav navbar-nav">
        <li class="active"><a href="#">Chat</a></li>
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown">Notifications
                <span class="caret"></span></a>
            <ul class="dropdown-menu dropdown-notification">
                <li ng-if="friendCtrl.friendRequestHandler.notifications.length > 0" ng-repeat="msg in friendCtrl.friendRequestHandler.notifications">
                    <img class="user-img" src="https://s3.postimg.org/yf86x7z1r/img2.jpg" alt="">
                    <p>
                        <b>{{ msg.sender }}</b>
                        <span ng-if="msg.status === friendCtrl.STATUS_CODES.PENDING">has sent you a friend request.</span>
                        <span ng-if="msg.status === friendCtrl.STATUS_CODES.ACCEPTED">has accepted your friend request.</span>
                    </p>
                </li>
                <li ng-if="friendCtrl.friendRequestHandler.notifications.length == 0">
                    <p>There isn't any notification.</p>
                </li>
            </ul>
        </li>
    </ul>
    <form class="navbar-form navbar-left">
        <div class="input-group search" id="searchUser">
            <div class="input-group-btn">
                <button class="btn btn-default" type="submit">
                    <i class="glyphicon glyphicon-user"></i>
                </button>
            </div>
            <input
                type="text" ng-model="friendCtrl.selectedUser" placeholder="Search username"
                class="form-control search-query" typeahead-template-url="userDisplay.html"
                uib-typeahead="user for user in friendCtrl.userList | filter:$viewValue:friendCtrl.startsWith | limitTo:8">
        </div>
    </form>
    <ul class="nav navbar-nav navbar-right">
        <li><a href="/logout"><span class="glyphicon glyphicon-log-in"></span> Log out</a></li>
    </ul>
</div>


